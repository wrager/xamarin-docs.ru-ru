---
title: Touch ID
description: "Touch ID используется для Apple отпечатков пальцев биометрической проверки подлинности."
ms.topic: article
ms.prod: xamarin
ms.assetid: 4BC8EFD6-52FC-4793-BA69-D6BFF850FE5F
ms.technology: xamarin-ios
author: bradumbaugh
ms.author: brumbaug
ms.date: 03/20/2017
ms.openlocfilehash: 7ee2af392a00e045b1992d189a15d7a0ee04b02f
ms.sourcegitcommit: 61f5ecc5a2b5dcfbefdef91664d7460c0ee2f357
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/28/2018
---
# <a name="touch-id"></a>Touch ID

Touch ID впервые появился в iOS 7, с точки зрения проверки подлинности пользователя — аналогично секретный код. Тем не менее он был ограничен разблокировки устройства, с помощью магазина приложений, с помощью iTunes и проверки подлинности только к цепочке ключей iCloud.

Сейчас существует два способа использовать Touch ID в качестве механизма проверки подлинности в приложении iOS 8, с помощью API локальной проверки подлинности. Он в настоящее время не поддерживается для использования локальной проверки подлинности для проверки подлинности удаленного.

Чтобы полностью понять Touch ID и его производительность, следует изучить цепочки ключей службы и что означают эти изменения для данных пользователей. Доступ к цепочке ключей также была расширена после в iOS 8 с помощью новой функции списки управления доступом (ACL).

## <a name="keychain--secure-enclave"></a>Цепочки ключей & безопасный Enclave

Цепочки ключей является большой базы данных, предоставляя безопасного хранения для пароли, ключи, сертификаты и примечания для одного отдельных Apple ID. В iOS 8 приложения всегда имеет доступ к элементам свой собственный уникальный цепочке ключей и нет доступа к цепочке ключей записей других приложений. Это отличается от OS X где цепочки ключей не будет разблокировано одним паролем, позволяя любой цепочке ключей службы приложения, поддерживающего использовать цепочку ключей. В этой статье рассматривается как цепочки ключей работает в iOS 8.

Цепочки ключей является специализированные базы данных, где каждая строка называется _элемент цепочки ключей_. Каждый элемент описываемого атрибутов в цепочке ключей и состоит из зашифрованных значений. Чтобы обеспечить эффективное использование цепочке ключей, он оптимизирован для небольших элементов или _секреты_.
Каждый элемент в цепочке ключей защищена пользователей секретный код и секрет уникальный устройства. Элементы в цепочке ключей должны быть защищены, даже в том случае, когда сотрудники не пользуются свои устройства. Это реализовано в iOS, позволяя элементы станут доступны, когда устройство будет разблокировано только, когда устройство заблокировано они становятся недоступными. Они также могут храниться в зашифрованной резервной копии. Является одним из ключевых особенностей цепочки ключей для обеспечения контроля доступа; приложение имеет доступ к его части цепочки ключей и не будет проверяться все остальные приложения. На приведенной ниже схеме показано, как приложение взаимодействует с цепочки ключей.

[![](touchid-images/image1.png "На этой диаграмме показано, как приложение взаимодействует с цепочки ключей")](touchid-images/image1.png)

### <a name="secure-enclave"></a>Безопасный Enclave

Цепочки ключей не удается расшифровать элемент цепочки ключей. Вместо этого он выполняется в *Secure Enclave*. Безопасный enclave является сопроцессора в микросхему A7, отвечает за определение совпадения из датчика Touch ID для зарегистрированного печати данные отпечатков пальцев. Затем будет расшифровать элемент цепочки ключей и вернуть расшифрованные секрет цепочки ключей.

### <a name="working-with-keychain"></a>Работа с цепочки ключей

Сначала приложение необходимо запросить в цепочке ключей, существует ли пароль. Если он не существует, может потребоваться ввести запрос пароля, поэтому пользователь не задаваемые постоянно. Если пароль должен быть обновлен, приглашение ввести новый пароль и передайте в измененное значение цепочки ключей.


> ℹ️ **Примечание**: С любой секретные данные, полученные из базы данных, он не просто рекомендация, но ожидается, что не секретные данные будут сохранены в памяти. Секрет для следует сохранить только в том случае, как долго, как это необходимо и абсолютно не назначайте ее глобальной переменной!




## <a name="keychain-acl-and-touch-id"></a>Идентификатор цепочки ключей ACL и жестов

Список управления доступом является атрибутом элемента новый цепочке ключей в iOS 8, описывающий сведения о том, что должны быть выполнены для разрешения конкретной операции или делать это. Это может быть в форме отображения диалогового окна предупреждения или запрашивающего секретный код. Список ACL позволяет задать специальных возможностей и проверки подлинности для ключей элементов. На приведенной ниже схеме показано, как этот новый атрибут привязывается остальной части цепочки ключей:

[![](touchid-images/image2.png "Эта схема показывает, каким образом этот новый атрибут привязывается остальной части цепочки ключей")](touchid-images/image2.png)

Начиная с версии iOS 8, теперь есть политику присутствия пользователя `SecAccessControl`, которой обеспечивается безопасное enclave на iPhone 5s и более поздних версий. Мы видим, в таблице ниже, так же как конфигурацию устройства могут повлиять на вычисления политики:

<table width="100%" border="1px">
<thead>
<tr>
    <td>Конфигурация устройства</td>
    <td>Оценка политики</td>
    <td>Механизм резервного копирования</td>
</tr>
</thead>
<tbody>
<tr>
    <td>Устройства без ввода секретного кода</td>
    <td>Нет доступа</td>
    <td>Нет</td>
</tr>
<tr>
    <td>Устройства с секретного кода</td>
    <td>Требуется секретного кода</td>
    <td>Нет</td>
</tr>
<tr>
    <td>Устройство с кодом сенсорного ввода</td>
    <td>Предпочитаемое Touch ID</td>
    <td>Позволяет секретного кода</td>
</tr>
</tbody>
</table>

Все операции внутри Enclave защиты можно доверять друг с другом. Это означает, что результат проверки подлинности Touch ID можно использовать для авторизации расшифровки элемента цепочки ключей. Enclave защиты также отслеживает счетчик неудачных Touch ID совпадений, в которых случай пользователь получит Чтобы возвратиться к использованию секретный код.
Новую платформу в iOS 8, вызывается _локальной проверки подлинности_, поддерживает этот процесс проверки подлинности в устройстве. Это рассматривается в следующем разделе.

## <a name="local-authentication"></a>Локальной проверки подлинности

Как мы установлено в предыдущем разделе, приложения могут использовать локальной проверки подлинности для проверки подлинности пользователя в соответствие с политикой безопасности, которые были настроены на устройстве.

В настоящее время API предоставляет только две возможности: во-первых, он помогает существующие цепочки ключей службы за счет использования новых ключей списки управления доступом (ACL). Данные цепочки ключей может быть разблокировано с успешной проверки подлинности пользователей по отпечатку пальца.

Во-вторых LocalAuthentication предоставляет два метода для проверки подлинности приложения локально. Разработчикам следует проявлять `CanEvaluatePolicy` для определения, является ли устройство способное принимать Touch ID и затем `EvaluatePolicy` для запуска операции проверки подлинности.

Хотя обе возможности обеспечивают локальной проверки подлинности, они не предоставляют механизм для приложения или пользователя для проверки подлинности на удаленном сервере.
Локальной проверки подлинности предоставляет новый стандартный пользовательский интерфейс для проверки подлинности. В случае Touch ID это представление предупреждений с две кнопки, как показано ниже. Одна кнопка "Отмена", а другая для использования резервной проверки подлинности — секретный код. Нет, необходимо задать пользовательское сообщение. Рекомендуется использовать его, чтобы объяснить пользователю, почему необходима проверка подлинности Touch ID.

[![](touchid-images/image12.png "Предупреждение проверки подлинности Touch ID")](touchid-images/image12.png)

### <a name="with-keychain-services"></a>Со службами цепочки ключей

Мы рассмотрели чуть раньше как элемент цепочки ключей является расшифровываются с помощью безопасного enclave для проверки нашей секретный код. В iOS 8 можно использовать локальной проверки подлинности для запроса проверки Touch ID в сочетании с функцией списки управления доступом, который обеспечивает реализацию резервный механизм или пароль.
Чтобы использовать ACL, следует использовать `SecAccessControl` политики, а затем проверить состояние устройства с помощью `SecAccessible.WhenPasscodeSetThisDeviceOnly` или `SecAccessible.WhenUnlocked`.

#### <a name="considerations-with-acl"></a>Вопросы, связанные с ACL

Существует множество операций, которые мы необходимо иметь в виду при использовании списков ACL с цепочки ключей и некоторые из них перечислены ниже:

-   Используйте только с приложением переднего плана — Если вы вызывать любую операцию цепочке ключей в фоновом потоке, вызов завершится ошибкой.
-   Добавление и обновление элементов цепочки ключей могут требовать проверки подлинности.
-   Если запрос возвращает несколько соответствующих элементов в цепочке ключей, может потребоваться проверка подлинности.
-   ACL защищенные элементы используются только для устройств и поэтому не синхронизированные или резервной копии.

### <a name="using-local-authentication-without-keychain-services"></a>С помощью локальной проверки подлинности без цепочки ключей служб

Локальной проверки подлинности был создан как способ для сбора учетных данных, например секретного кода или Touch ID и работы с Enclave защиты, чтобы завершить проверку подлинности пользователя. Его можно рассматривать как мост между приложением и Enclave защиты, который может никогда не выполняется напрямую взаимодействовать друг с другом. Он также может использоваться для вычисления политики для вашего приложения.

Для этого приложения вызывает оценки политики внутри локальной проверки подлинности, которая запускает операцию внутри Enclave защиты. Можно использовать этот параметр, чтобы обеспечить проверку подлинности для приложения, без прямого запроса или доступа к Enclave защиты.

[![](touchid-images/image13a.png "С помощью локальной проверки подлинности без цепочки ключей служб")](touchid-images/image13a.png)

Использование локальной проверки подлинности в приложении предоставляет простой способ реализации проверки пользователя, например разблокировать компонент исключительно для с точки зрения владельца устройства, например банковских приложениях, или чтобы помочь родительского контроля лицом приложение. Его также можно использовать, чтобы расширить проверку подлинности, который уже существует — свои сведения для обеспечения безопасности, таких как пользователи, но они хотели имеют параметры.

Безопасность локальной проверки подлинности отличается от цепочку ключей. Например при использовании цепочки ключей, доверие является между операционной системой и Enclave защиты. С помощью локальной проверки подлинности это между приложением и операционной системы, то есть только иметь доступ к результатам Enclave защиты, не Secure Enclave сам.

На субъекта безопасности, его также очень важно знать, что имеется **нет доступа** зарегистрированных пальцами или отпечатков пальцев изображения. Enclave защиты является владельцем этой информации, и поэтому другого системного компонента имеет к нему доступ.

Чтобы использовать Touch ID без цепочки ключей за счет использования API локальной проверки подлинности, существует несколько функций, которые можно использовать. Они описаны ниже.

*   `CanEvaluatePolicy` — Это просто проверит, является ли устройство способное принимать Touch ID.
*   `EvaluatePolicy` — Это запускает операцию проверки подлинности и отображает пользовательский Интерфейс и возвращает `true` или `false` ответов.
*   `DeviceOwnerAuthenticationWithBiometrics` — Это политики, который может использоваться для отображения на экране Touch ID. Стоит отметить, что отсутствует секретного кода резервный механизм здесь, вместо этого следует реализовать в приложении, чтобы разрешить пользователям пропускать проверки подлинности Touch ID этой резервной.

Существует несколько моментов, с использованием локальной проверки подлинности, в которой перечислены ниже:

*   Как и в цепочке ключей, он могут выполняться только на переднем плане. Вызов его в фоновом потоке приведет к сбою.
*   Имейте в виду, что оценки политики может завершиться ошибкой. Кнопка секретный код будет необходимо реализовать как запасной.
*   Необходимо указать `localizedReason` объяснить, почему необходима проверка подлинности. Это помогает установить доверительные отношения с пользователем.

Далее в следующем разделе мы рассмотрим способы реализации API, учитывая эти предупреждения.

## <a name="adding-touch-id-to-your-application"></a>Добавление в приложение Touch ID

В предыдущих разделах мы рассмотрели теория доступ и проверка подлинности с помощью цепочки ключей и локальной проверки подлинности. Вы будете направлены рассматриваются как Touch ID в можно интегрировать в приложение.

### <a name="walkthrough"></a>Пошаговое руководство

Так что давайте рассмотрим добавление некоторые Authentication Touch ID для нашего приложения. В этом пошаговом руководстве мы будем использовать [таблицы раскадровки](https://developer.xamarin.com/samples/StoryboardTable/) образца. Мы хотели бы убедиться, что только владельцу устройства можно добавить что-то в этот список, мы не хотим загромождать, позволяя всем добавить элемент!

1.  Загрузить пример, а затем запустите его в Visual Studio для Mac.
2.  Дважды щелкните `MainStoryboard.Storyboard` Открытие образца в конструкторе iOS. В этом примере мы хотим добавить новый экран для нашего приложения, который будет управлять проверки подлинности. Это будет отправлена до текущей `MasterViewController`.
3.  Перетащите новую **View Controller** из **элементов** для **конструктора**. Задать как **корневой View Controller** по **клавишу Ctrl при перетаскивании** из **навигации контроллера**:

    [![](touchid-images/image4.png "Задайте корневой View Controller")](touchid-images/image4.png)
4.  Имя нового представления контроллера `AuthenticationViewController`.
5.  Затем перетащите кнопку и поместите ее на `AuthenticationViewController`. Эта `AuthenticateButton`и назначьте ему текст `Add a Chore`.
6.  Создать событие на `AuthenticateButton` вызывается `AuthenticateMe`.
7.  Создать вручную перейти из `AuthenticationViewController` , щелкнув черная полоса внизу и **клавишу Ctrl при перетаскивании** из панели, чтобы `MasterViewController` и выбрав **принудительной** (или **Показать** При использовании классов размер):

    [![](touchid-images/image5.png "Перетащите из панели MasterViewController и кнопки принудительной или Показать")](touchid-images/image6.png)
8.  Щелкните только что созданный перейти и присвойте ему идентификатор `AuthenticationSegue`, как показано ниже:

    [![](touchid-images/image7.png "Значение идентификатора segue AuthenticationSegue")](touchid-images/image7.png)
9.  Добавьте следующий код в файл `AuthenticationViewController`:

    ```
    partial void AuthenticateMe (UIButton sender)
        {
            var context = new LAContext();
            NSError AuthError;
            var myReason = new NSString("To add a new chore");


            if (context.CanEvaluatePolicy(LAPolicy.DeviceOwnerAuthenticationWithBiometrics, out AuthError)){
                var replyHandler = new LAContextReplyHandler((success, error) => {

                    this.InvokeOnMainThread(()=>{
                        if(success){
                            Console.WriteLine("You logged in!");
                            PerformSegue("AuthenticationSegue", this);
                        }
                        else{
                            //Show fallback mechanism here
                        }
                    });

                });
                context.EvaluatePolicy(LAPolicy.DeviceOwnerAuthenticationWithBiometrics, myReason, replyHandler);
            };
        }
    ```

Это весь код, необходимо реализовать проверку подлинности Touch ID, с использованием локальной проверки подлинности. Выделенные линии на рисунке ниже показано использование локальной проверки подлинности:

[![](touchid-images/image8.png "Выделенные строки показано использование локальной проверки подлинности")](touchid-images/image8.png)

Во-первых, необходимо определить, является ли устройство способное принимать Touch ID ввода с помощью `CanEvaluatePolicy` и передачи в политике `DeviceOwnerAuthenticationWithBiometrics`. Если это так, то можно отобразить с помощью пользовательского интерфейса Touch ID `EvaluatePolicy`. Существует три элемента информации, нам нужно передать в `EvaluatePolicy` — сама политика, строка, объясняющая, почему требуется проверка подлинности и обработчик ответа. Обработчик ответ сообщает приложению, что нужно делать в случае успешной или неудачной, проверки подлинности. Давайте взглянем более подробно в обработчике ответа:

[![](touchid-images/image9.png "Обработчик ответа")](touchid-images/image9.png)

Обработчик ответа определяется типа `LAContextReplyHandler`, принимающий успех параметров — `bool` значение и `NSError` вызывается `error`. Если она выполнена успешно, это где будет фактически выполнена то, что мы хотим проверки подлинности — в этом случае отображение на экране, сообщите нам будет добавлен новый тяжелой задачей. Запомнить одно оговорками локальной проверки подлинности, его необходимо запустить на переднем плане, поэтому убедитесь, что использование `InvokeOnMainThread`:

[![](touchid-images/image10.png "Используйте InvokeOnMainThread для локальной проверки подлинности")](touchid-images/image10.png)

Наконец, проверка подлинности прошла успешно, мы хотим переход `MasterViewController`. `PerformSegue` Метод может использоваться для этого:

[![](touchid-images/image11.png "Вызовите метод PerformSegue переход MasterViewController")](touchid-images/image11.png)

## <a name="summary"></a>Сводка
В этом руководстве мы рассматривали цепочки ключей и как это работает в iOS. Мы также изучена цепочки ключей ACL и изменения в нем в iOS. Затем мы воспользовались взглянуть на платформу локальной проверки подлинности, которая является новым в iOS 8 и затем рассказывали реализации проверки подлинности Touch ID в приложении.

## <a name="related-links"></a>Связанные ссылки

- [Пример идентификатора сенсорного ввода](https://developer.xamarin.com/samples/StoryboardTable_LocalAuthentication)
- [Образец WWDC цепочки ключей](https://developer.xamarin.com/samples/KeychainTouchID/)
- [Цепочки ключей (пример)](https://developer.xamarin.com/samples/Keychain/)
