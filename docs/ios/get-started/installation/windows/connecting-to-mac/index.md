---
title: Связывание с компьютером Mac
description: В этом руководстве описывается использование функции "Связать с Mac" для подключения Visual Studio 2017 к узлу сборки Mac.
ms.prod: xamarin
ms.assetid: 39DD7B3F-3E69-4E2A-B743-4C26AF613025
ms.technology: xamarin-ios
author: bradumbaugh
ms.author: brumbaug
ms.date: 04/16/2018
ms.openlocfilehash: e2f9b23bb298b0bb01f7e5491963daed4521ac9c
ms.sourcegitcommit: 9f8e7393019791bbd6af4fefaa24a1602adabb4e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/23/2018
---
# <a name="pair-to-mac"></a>Связывание с компьютером Mac

_В этом руководстве описывается использование функции "Связать с Mac" для подключения Visual Studio 2017 к узлу сборки Mac._

## <a name="overview"></a>Обзор

Сборка приложений в машинном коде iOS требует доступа к средствам сборки Apple, которые выполняются только на компьютере Mac. Поэтому для сборки приложений Xamarin.iOS систему Visual Studio 2017 необходимо подключить к доступному по сети компьютеру Mac.

Функция Visual Studio 2017 "Связать с Mac" обнаруживает узлы сборки Mac, подключается к ним, выполняет проверку подлинности и запоминает их, что упрощает сборку приложений для iOS в среде Windows. 

Функция "Связать с Mac" включает следующий рабочий процесс разработки.

- Разработчики могут создавать код Xamarin.iOS в Visual Studio 2017.

- Visual Studio 2017 открывает сетевое подключение к узлу сборки Mac и использует средства сборки на этом компьютере для компиляции и подписания приложения iOS.

- Нет необходимости запускать отдельные приложения на компьютере Mac: Visual Studio 2017 вызывает сборки Mac через безопасное SSH-подключение.

- Visual Studio 2017 уведомляет об изменениях по мере их возникновения. Например, когда устройство iOS подключается к Mac или становится доступным в сети, панель инструментов iOS мгновенно обновляется.

- К компьютеру Mac можно подключить несколько экземпляров Visual Studio 2017 одновременно.

- Можно использовать командную строку Windows для создания приложений iOS.

> [!NOTE]
> Перед выполнением инструкций в этом руководстве выполните следующие действия. 
> 
> - На компьютере Windows [установите Visual Studio 2017](~/cross-platform/get-started/installation/windows.md).
> - На компьютере Mac [установите Xcode](https://itunes.apple.com/us/app/xcode/id497799835?mt=12) и [Visual Studio для Mac](https://docs.microsoft.com/visualstudio/mac/installation).
>
> Если вы не хотите устанавливать Visual Studio для Mac, Visual Studio 2017 может автоматически настроить на узле сборки Mac Xamarin.iOS и Mono.
> Дополнительные сведения см. в разделе [Автоматическая подготовка Mac](#automatic-mac-provisioning).

## <a name="enable-remote-login-on-the-mac"></a>Включение удаленного входа в систему на компьютере Mac

Чтобы настроить узел сборки Mac, сначала необходимо включить удаленный вход в систему.

1. На компьютере Mac откройте System Preferences (Системные настройки) и перейдите к панели **Sharing** (Общий доступ).

2. Установите флажок **Remote Login** (Удаленный вход) в списке **Service** (Служба).

    ![Включение удаленного входа в систему](images/sharing.png "Включение удаленного входа в систему")

    Убедитесь, что доступ разрешен всем пользователям (**All users**) или что ваше имя пользователя Mac или группа включены в список разрешенных пользователей.

3. При появлении запроса настройте брандмауэр macOS.

    Если в брандмауэре macOS настроено блокирование входящих подключений, вам потребуется разрешить программе `mono-sgen` принимать входящие подключения. В этом случае появляется соответствующее предупреждение.

4. Компьютер Mac теперь должен обнаруживаться средой Visual Studio 2017, если они находятся в одной сети с компьютером Windows. Если компьютер Mac по-прежнему не обнаруживается, попробуйте [вручную добавить компьютер Mac](#manually-add-a-mac) или прочтите [руководство по устранению неполадок](~/ios/get-started/installation/windows/connecting-to-mac/troubleshooting.md).

## <a name="connect-to-the-mac-from-visual-studio-2017"></a>Подключение к компьютеру Mac из Visual Studio 2017

После включения удаленного входа в систему подключите Visual Studio 2017 к компьютеру Mac.

1. В Visual Studio 2017 откройте существующий проект iOS или создайте новый, щелкнув **Файл > Создать > Проект** и выбрав шаблон проекта iOS.

2. Откройте диалоговое окно **Связать с Mac**. 

    - Используйте кнопку **Связать с Mac** на панели инструментов iOS:

        ![Панель инструментов iOS с выделенной кнопкой "Связать с Mac"](images/ios-toolbar.png "Панель инструментов iOS с выделенной кнопкой \"Связать с Mac\"")

    - Также можно выбрать **Инструменты > iOS > Связать с Mac**.

    - В диалоговом окне **Связать с Mac** отображается список всех ранее подключенных и доступных сейчас узлов сборки Mac:

        ![Диалоговое окно "Связать с Mac"](images/pairtomac.png "Диалоговое окно \"Связать с Mac\"")

3. Выберите в списке компьютер Mac. Нажмите кнопку **Подключиться**. 

4. Введите свое имя пользователя и пароль.
    
    - При первом подключении к любому конкретному компьютеру Mac предлагается ввести имя пользователя и пароль для этого компьютера:

        ![Ввод имени пользователя и пароля для компьютера Mac](images/auth.png "Ввод имени пользователя и пароля для компьютера Mac")

        > [!TIP]
        > При входе в систему используйте системное имя пользователя, а не полное имя.

    - Функция "Связать с Mac" будет использовать эти учетные данные для создания подключения SSH к компьютеру Mac. В случае успеха в файл **authorized_keys** на компьютере Mac добавляется ключ. При последующих подключениях к тому же компьютеру Mac вход будет выполняться автоматически.

5. Функция "Связать с Mac" автоматически настраивает Mac.

    [Начиная с Visual Studio 2017 версии 15.6](https://docs.microsoft.com/visualstudio/releasenotes/vs2017-relnotes#automatic-macos-provisioning) среда Visual Studio 2017 устанавливает или обновляет Mono и Xamarin.iOS на подключенном узле сборки Mac при необходимости (учтите, что Xcode необходимо по-прежнему устанавливать вручную). Дополнительные сведения см. в разделе [Автоматическая подготовка Mac](#automatic-mac-provisioning).

6. Найдите значок состояния подключения.
    
    - Когда Visual Studio 2017 подключена к компьютеру Mac, для этого элемента Mac в диалоговом окне **Связать с Mac** отображается значок активного подключения:

        ![Подключенный компьютер Mac](images/connected.png "Подключенный компьютер Mac")

      Одновременно может быть подключен только один компьютер Mac.

      > [!TIP]
      > Щелкните правой кнопкой мыши любой компьютер Mac в списке **Связать с Mac**: появится контекстное меню с пунктами **Подключить...**, **Не сохранять данные этого компьютера Mac** или **Отключить**:
      >
      > ![Контекстные меню "Связать с Mac"](images/contextmenu.png "Контекстные меню \"Связать с Mac\"") 
      >
      > При выборе варианта **Не сохранять данные этого компьютера Mac** ваши учетные данные для выбранного компьютера Mac удаляются. Для повторного подключения к этому компьютеру Mac потребуется заново ввести имя пользователя и пароль.

Если подключение к узлу сборки Mac выполнено успешно, вы можете начинать создавать приложения Xamarin.iOS в Visual Studio 2017. Прочитайте руководство [Введение в Xamarin.iOS для Visual Studio](~/ios/get-started/installation/windows/introduction-to-xamarin-ios-for-visual-studio.md).

Если вам не удалось выполнить связывание с компьютером Mac, попробуйте [вручную добавить компьютер Mac](#manually-add-a-mac) или прочтите [руководство по устранению неполадок](~/ios/get-started/installation/windows/connecting-to-mac/troubleshooting.md).

## <a name="manually-add-a-mac"></a>Добавление компьютера Mac вручную

Если вы не видите конкретный компьютер Mac в списке в диалоговом окне **Связать с Mac**, добавьте его вручную.

1. Найдите IP-адрес нужного компьютера Mac. 

    - На компьютере Mac откройте **System Preferences (Системные настройки) > Sharing (Общий доступ) > Remote Login (Удаленный вход)**:

        [![IP-адрес компьютера Mac в разделе "Системные настройки" > "Общий доступ"](images/sharing-ipaddress.png "IP-адрес компьютера Mac в разделе \"Системные настройки\" > \"Общий доступ\"")](images/sharing.png#lightbox)

    - Кроме того, можно использовать командную строку. В окне терминала выполните эту команду: 
   
        ```bash
        $ ipconfig getifaddr en0
        196.168.1.8
        ```

      В зависимости от конфигурации сети может потребоваться использовать имя интерфейса, отличное от `en0`. Например, `en1`, `en2` и т. д.

2. В диалоговом окне **Связать с Mac** Visual Studio 2017 выберите **Добавить компьютер Mac...**:

    [![Кнопка "Добавить компьютер Mac" в диалоговом окне "Связать с Mac"](images/addtomac.png "Кнопка \"Добавить компьютер Mac\" в диалоговом окне \"Связать с Mac\"")](images/addtomac-large.png#lightbox)

3. Введите IP-адрес компьютера Mac и нажмите кнопку **Добавить**:

    ![Ввод IP-адреса компьютера Mac](images/enteripaddress.png "Ввод IP-адреса компьютера Mac")

4. Введите свое имя пользователя и пароль для компьютера Mac:

    ![Ввод имени пользователя и пароля](images/auth.png "Ввод имени пользователя и пароля")

   > [!TIP]
   > При входе в систему используйте системное имя пользователя, а не полное имя.

5. Нажмите кнопку **Войти**, чтобы подключить Visual Studio 2017 к Mac через SSH и добавить его в список известных компьютеров.

## <a name="automatic-mac-provisioning"></a>Автоматическая подготовка Mac

Начиная с [Visual Studio 2017 версии 15.6](https://docs.microsoft.com/visualstudio/releasenotes/vs2017-relnotes#automatic-macos-provisioning) функция "Связать с Mac" автоматически предоставляет компьютеру Mac программное обеспечение, необходимое для создания приложений Xamarin.iOS: Mono, Xamarin.iOS (программная платформа, а не интегрированная среда разработки Visual Studio для Mac) и различные инструменты, связанные с Xcode (но не сам Xcode).

> [!IMPORTANT]
> - Функция "Связать с Mac" не может установить Xcode: этот компонент необходимо установить на узле сборки Mac вручную. Он требуется для разработки Xamarin.iOS.
> - Автоматическая подготовка Mac требует, чтобы на компьютере Mac был включен удаленный вход и чтобы компьютер Mac был доступен по сети для компьютера Windows. Дополнительные сведения см. в разделе [Включение удаленного входа на компьютере Mac](#enable-remote-login-on-the-mac).

Функция "Связать с Mac" выполняет установку или обновление необходимого программного обеспечения, когда Visual Studio 2017 [подключается к компьютеру Mac](#connect-to-the-mac-from-visual-studio-2017).

### <a name="mono"></a>Mono

Функция "Связать с Mac" проверяет наличие Mono. Если этот компонент не установлен, функция "Связать с Mac" загрузит и установит последнюю стабильную версию Mono на компьютере Mac. 

В ходе выполнения выводятся различные запросы, как показано на следующих снимках экрана (щелкните, чтобы увеличить):

||Проверка установки|Загрузка|Установка
|---|---|---|---|
|Mono|[![Установка Mono отсутствует](images/mono-missing.png "Установка Mono отсутствует")](images/mono-missing-large.png#lightbox)|[![Загрузка Mono](images/mono-downloading.png "Загрузка Mono")](images/mono-downloading-large.png#lightbox)|[![Установка Mono](images/mono-installing.png "Установка Mono")](images/mono-installing-large.png#lightbox)|

### <a name="xamarinios"></a>Xamarin.iOS 

Функция "Связать с Mac" обновляет Xamarin.iOS на Mac так, чтобы его версия соответствовала версии, установленной на компьютере Windows.

> [!IMPORTANT]
> Функция "Связать с Mac" не будет переходить на использование более ранней версии Xamarin.iOS на компьютере Mac (то есть заменять альфа- и бета-версии на стабильную). При наличии Visual Studio для Mac настройте [канал выпуска](https://docs.microsoft.com/visualstudio/mac/update) следующим образом.
> - Если вы используете Visual Studio 2017, выберите **стабильный** канал обновлений в Visual Studio для Mac.
> - Если вы используете предварительную версию Visual Studio 2017, выберите **альфа**-канал обновлений в Visual Studio для Mac.

В ходе выполнения выводятся различные запросы, как показано на следующих снимках экрана (щелкните, чтобы увеличить):

||Проверка установки|Загрузка|Установка
|---|---|---|---|
|Xamarin.iOS|[![Установка Xamarin.iOS отсутствует](images/xamios-missing.png "Установка Xamarin.iOS отсутствует")](images/xamios-missing-large.png#lightbox)|[![Загрузка Xamarin.iOS](images/xamios-downloading.png "Загрузка Xamarin.iOS")](images/xamios-downloading-large.png#lightbox)|[![Установка Xamarin.iOS](images/xamios-installing.png "Установка Xamarin.iOS")](images/xamios-installing-large.png#lightbox)|

### <a name="xcode-tools-and-license"></a>Средства и лицензии Xcode

Функция "Связать с Mac" также проверяет наличие установки Xcode и принятие его лицензии. Функция "Связать с Mac" не устанавливает Xcode, однако предлагает принять условия лицензионного соглашения, как показано на следующих снимках экрана (щелкните, чтобы увеличить):

||Проверка установки|Принятие условий лицензионного соглашения|
|---|---|---|
|Xcode|[![Установка Xcode отсутствует](images/xcode-missing.png "Установка Xcode отсутствует")](images/xcode-missing-large.png#lightbox)|[![Лицензия Xcode](images/xcode-license.png "Лицензия Xcode")](images/xcode-license-large.png#lightbox)|

Кроме того, функция "Связать с Mac" установит или обновит различные пакеты, распространяемые с Xcode. Пример:

- **MobileDeviceDevelopment.pkg**
- **XcodeExtensionSupport.pkg**
- **MobileDevice.pkg**
- **XcodeSystemResources.pkg**

Установка этих пакетов выполняется быстро и без запросов.

> [!NOTE]
> Эти средства отличаются от программ командной строки Xcode, которые в системе macOS 10.9 [устанавливаются вместе с Xcode](https://developer.apple.com/library/content/technotes/tn2339/_index.html).

### <a name="troubleshooting-automatic-mac-provisioning"></a>Устранение неполадок автоматической подготовки Mac

Если у вас возникают проблемы с автоматической подготовкой Mac, просмотрите журналы IDE Visual Studio 2017 по пути **%LOCALAPPDATA%\Xamarin\Logs\15.0**. Эти журналы могут содержать сообщения об ошибках, которые помогут эффективнее диагностировать ошибку или получить поддержку.

## <a name="build-ios-apps-from-the-windows-command-line"></a>Создание приложений iOS из командной строки Windows 

Функция "Связать с Mac" поддерживает сборку приложений Xamarin.iOS из командной строки. Пример:

```bash
C:\samples\App1>msbuild App1.sln /p:ServerAddress=10.211.55.2 /p:ServerUser=xamUser /p:Platform=iPhoneSimulator /p:ServerPassword=mypassword
```
Параметры, передаваемые в `msbuild` в приведенном выше примере:

- `ServerAddress` — IP-адрес узла сборки Mac.
- `ServerUser` — имя пользователя, используемое при входе в систему узла сборки Mac.
  Используйте системное имя пользователя, а не полное имя.
- `ServerPassword` — пароль, используемый при входе в систему узла сборки Mac.
 
> [!NOTE]
> Visual Studio 2017 хранит `msbuild` в следующем каталоге: **C:\Program Files (x86)\Microsoft Visual Studio\2017\<версия>\MSBuild\15.0\Bin**

При первом входе функции "Связать с Mac" в систему определенного узла сборки Mac из Visual Studio 2017 или из командной строки она устанавливает ключи SSH. Благодаря этим ключам в дальнейшем при входе не потребуется указывать имя пользователя или пароль. Вновь созданные ключи хранятся по пути **%LOCALAPPDATA%\Xamarin\MonoTouch**.

Если параметр `ServerPassword` исключается из вызова сборки из командной строки, функция "Связать с Mac" пытается выполнить вход на узел сборки Mac, используя сохраненные ключи SSH.

## <a name="summary"></a>Сводка

В этой статье описано, как использовать функцию "Связать с Mac" для подключения Visual Studio 2017 к узлу сборки Mac, чтобы разработчики Visual Studio 2017 могли выполнять сборку приложений iOS в машинном коде с помощью Xamarin.iOS.

## <a name="next-steps"></a>Следующие шаги

- [Устранение неполадок при подключении](~/ios/get-started/installation/windows/connecting-to-mac/troubleshooting.md)
- [Xamarin Mac Build Agent - Xamarin University Lightning Lecture](https://www.youtube.com/watch?v=MBAPBtxkjFQ)
- [Введение в Xamarin.iOS для Visual Studio](~/ios/get-started/installation/windows/introduction-to-xamarin-ios-for-visual-studio.md)
- [Удаленный симулятор iOS для Windows](~/tools/ios-simulator.md)
- [Wireless Deployment](~/ios/deploy-test/wireless-deployment.md) (Развертывание по беспроводному доступу)

