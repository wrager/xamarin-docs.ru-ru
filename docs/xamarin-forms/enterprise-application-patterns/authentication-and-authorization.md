---
title: "–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è"
ms.topic: article
ms.prod: xamarin
ms.assetid: e3f27b4c-f7f5-4839-a48c-30bcb919c59e
ms.technology: xamarin-forms
author: davidbritch
ms.author: dabritch
ms.date: 08/08/2017
ms.openlocfilehash: 5f27c1acefa63ee26184b8997594630e24cb0acc
ms.sourcegitcommit: 30055c534d9caf5dffcfdeafd6f08e666fb870a8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/09/2018
---
# <a name="authentication-and-authorization"></a>–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ ‚Äî —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–ª—É—á–µ–Ω–∏—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã—Ö —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, —Ç–∞–∫–∏–µ –∫–∞–∫ –∏–º—è –∏ –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —ç—Ç–∏—Ö —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª–Ω–æ–º–æ—á–∏–π. –ï—Å–ª–∏ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —è–≤–ª—è—é—Ç—Å—è –¥–æ–ø—É—Å—Ç–∏–º—ã–º–∏, —Å—É—â–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø—Ä–æ—à–µ–¥—à–∏–º –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏. –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω–æ–º—É —Ä–µ—Å—É—Ä—Å—É.

–°—É—â–µ—Å—Ç–≤—É–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Xamarin.Forms, –∫–æ—Ç–æ—Ä—ã–π –æ–±–º–µ–Ω–∏–≤–∞–µ—Ç—Å—è –¥–∞–Ω–Ω—ã–º–∏ —Å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ASP.NET MVC, –≤–∫–ª—é—á–∞—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤–Ω–µ—à–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä Microsoft, Google, —Å –ø–æ–º–æ—â—å—é ASP.NET Core Identity, Facebook –∏–ª–∏ Twitter –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –ø–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Å–ª–æ—è. –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ eShopOnContainers –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é –º–∏–∫—Ä–æ—Å–ª—É–∂–±—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–æ–≥–æ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–π, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π IdentityServer 4. –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç IdentityServer, –º–∞—Ä–∫–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ—Å—É—Ä—Å—É. –î–ª—è IdentityServer –¥–ª—è –≤—ã–¥–∞—á–∏ —Ç–æ–∫–µ–Ω–æ–≤ –æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –í–æ–π–¥–∏—Ç–µ –Ω–∞ IdentityServer. –û–¥–Ω–∞–∫–æ IdentityServer –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ eShopOnContainers —Å—Å—ã–ª–∫—É –¥–ª—è —ç—Ç–æ–π —Ü–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ASP.NET Core Identity.

## <a name="authentication"></a>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏

–¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏, –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. ASP.NET Core –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Äî —Å–∏—Å—Ç–µ–º–∞ —á–ª–µ–Ω—Å—Ç–≤–∞ ASP.NET Core Identity, –≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Å–≤–µ–¥–µ–Ω–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö, –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º. –ö–∞–∫ –ø—Ä–∞–≤–∏–ª–æ —ç—Ç–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–µ EntityFramework, —Ö–æ—Ç—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â–∞—Ö –∏–ª–∏ –ø–∞–∫–µ—Ç—ã —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ Azure, DocumentDB –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö.

–î–ª—è —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏ –∫–æ—Ç–æ—Ä—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç —Å–≤–µ–¥–µ–Ω–∏—è –æ–± —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ —á–µ—Ä–µ–∑ —Ñ–∞–π–ª—ã cookie (–∫–∞–∫ –æ–±—ã—á–Ω–æ –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö ASP.NET MVC), ASP.NET Core Identity ‚Äî —ç—Ç–æ –ø–æ–¥—Ö–æ–¥—è—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ. –¢–µ–º –Ω–µ –º–µ–Ω–µ–µ —Ñ–∞–π–ª—ã cookie –Ω–µ –≤—Å–µ–≥–¥–∞ —è–≤–ª—è—é—Ç—Å—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –æ–∑–Ω–∞—á–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö. –ù–∞–ø—Ä–∏–º–µ—Ä –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ASP.NET Core, RESTful –∫–æ–Ω–µ—á–Ω—ã–µ —Ç–æ—á–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è –∏–∑ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ–±—ã—á–Ω–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –Ω–æ—Å–∏—Ç–µ–ª—è, —Ç–∞–∫ –∫–∞–∫ –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã cookie. –¢–µ–º –Ω–µ –º–µ–Ω–µ–µ —Ç–æ–∫–µ–Ω—ã –Ω–æ—Å–∏—Ç–µ–ª—è –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –ø–æ–ª—É—á–∞—Ç—å –∏ –≤–∫–ª—é—á–µ–Ω—ã –≤ —Å–æ—Å—Ç–∞–≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤–µ–±-–∑–∞–ø—Ä–æ—Å–æ–≤, –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∏–∑ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### <a name="issuing-bearer-tokens-using-identityserver-4"></a>–í—ã–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–æ–≤ –Ω–æ—Å–∏—Ç–µ–ª—è —Å –ø–æ–º–æ—â—å—é IdentityServer 4

[IdentityServer 4](https://github.com/IdentityServer/IdentityServer4) ‚Äî —ç—Ç–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ OpenID Connect –∏ OAuth 2.0 –æ—Ç–∫—Ä—ã—Ç—ã–º –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º, –¥–ª—è ASP.NET Core, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –º–Ω–æ–≥–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –≤–∫–ª—é—á–∞—è –≤—ã–¥–∞–µ—Ç –º–∞—Ä–∫–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ASP.NET Core Identity.

> [!NOTE]
> OpenID Connect –∏ OAuth 2.0 –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–∏, –∏–º–µ—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏.

OpenID Connect –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —É—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ OAuth 2.0. OAuth 2 ‚Äî —ç—Ç–æ –ø—Ä–æ—Ç–æ–∫–æ–ª, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –º–∞—Ä–∫–µ—Ä–æ–≤ –¥–æ—Å—Ç—É–ø–∞ –æ—Ç —Å–ª—É–∂–±—ã –º–∞—Ä–∫–µ—Ä–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã. –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–Ω–∏–∂–∞–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Å –º–æ–º–µ–Ω—Ç–∞ –º–æ–∂–Ω–æ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

–°–æ—á–µ—Ç–∞–Ω–∏–µ OpenID Connect –∏ OAuth 2.0 –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –¥–≤—É—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏ –¥–æ—Å—Ç—É–ø–∞ –∫ API –∏ IdentityServer 4 ‚Äî —ç—Ç–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —ç—Ç–∏—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤.

–í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö –ø—Ä—è–º–æ–π –æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞ –º–∏–∫—Ä–æ—Å–ª—É–∂–±—É, –Ω–∞–ø—Ä–∏–º–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å—Å—ã–ª–∫—É eShopOnContainers –º–∏–∫—Ä–æ—Å–ª—É–∂–±—É –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏, –≤—ã—Å—Ç—É–ø–∞—é—â–µ–≥–æ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ç–æ–∫–µ–Ω–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–ª—É–∂–±—ã (STS) –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –Ω–∞ —Ä–∏—Å—É–Ω–∫–µ 9-1. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ –ø—Ä—è–º–æ–π –æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞ –º–∏–∫—Ä–æ—Å–ª—É–∂–±—É —Ä–∞–∑–¥–µ–ª–µ [–æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏ –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ –ú–∏–∫—Ä–æ—Å–ª—É–∂–±–∞–º–∏](~/xamarin-forms/enterprise-application-patterns/containerized-microservices.md#communication_between_client_and_microservices).

![](authentication-and-authorization-images/authentication.png "–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —Å –º–∏–∫—Ä–æ—Å–ª—É–∂–±—É –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏")

**–†–∏—Å. 9-1:** –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –ø—É—Ç–µ–º –º–∏–∫—Ä–æ—Å–ª—É–∂–±—É –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏

–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ eShopOnContainers –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –º–∏–∫—Ä–æ—Å–ª—É–∂–±—É —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π IdentityServer 4 –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –¥–ª—è API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –º–∞—Ä–∫–µ—Ä—ã IdentityServer, –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ—Å—É—Ä—Å—É:

-   –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —Å IdentityServer –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è, –∑–∞–ø—Ä–∞—à–∏–≤–∞—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è *—É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ* –º–∞—Ä–∫–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏. –ö–∞–∫ –º–∏–Ω–∏–º—É–º –æ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–≤–µ–¥–µ–Ω–∏—è –æ —Ç–æ–º, –∫–∞–∫ –∏ –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏. –û–Ω —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
-   –î–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å—É —Å IdentityServer –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –ø—É—Ç–µ–º –∑–∞–ø—Ä–æ—Å–∞ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ *–¥–æ—Å—Ç—É–ø–∞* –º–∞—Ä–∫–µ—Ä, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å—É API. –ö–ª–∏–µ–Ω—Ç—ã –∑–∞–ø—Ä–æ—Å–∞ –º–∞—Ä–∫–µ—Ä–æ–≤ –¥–æ—Å—Ç—É–ø–∞ –∏ –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å –∏—Ö –≤ API. –ú–∞—Ä–∫–µ—Ä—ã –¥–æ—Å—Ç—É–ø–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç —Å–≤–µ–¥–µ–Ω–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–ø—Ä–∏ –µ–≥–æ –Ω–∞–ª–∏—á–∏–∏). API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –∑–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –∏—Ö –¥–∞–Ω–Ω—ã–º.

> [!NOTE]
> –ö–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω IdentityServer –ø—Ä–µ–∂–¥–µ —á–µ–º –æ–Ω —Å–º–æ–∂–µ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã.

### <a name="adding-identityserver-to-a-web-application"></a>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ IdentityServer –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

–ß—Ç–æ–±—ã –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ASP.NET Core –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è IdentityServer 4 –µ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–ª—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ Visual Studio –¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –æ–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ](https://identityserver4.readthedocs.io/en/release/quickstarts/0_overview.html) –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ IdentityServer.

–ü–æ—Å–ª–µ IdentityServer –≤–∫–ª—é—á–µ–Ω –≤ —Ä–µ—à–µ–Ω–∏–µ Visual Studio –¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –µ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–ª—è—Ç—å –≤ –∫–æ–Ω–≤–µ–π–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ HTTP –¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —á—Ç–æ–±—ã –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –∫–æ–Ω–µ—á–Ω—ã–º —Ç–æ—á–∫–∞–º OpenID Connect –∏ OAuth 2.0. –≠—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤ `Configure` –º–µ—Ç–æ–¥–∞ –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ `Startup` –∫–ª–∞—Å—Å–∞, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞:

```csharp
public void Configure(  
    IApplicationBuilder app, IHostingEnvironment env, ILoggerFactory loggerFactory)  
{  
    ...  
    app.UseIdentity();  
    ...  
}
```

–ü–æ—Ä—è–¥–æ–∫ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –∫–æ–Ω–≤–µ–π–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ HTTP –¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º IdentityServer –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω–≤–µ–π–µ—Ä, –ø—Ä–µ–∂–¥–µ —á–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–ª–∏–∑—É–µ—Ç —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞.

### <a name="configuring-identityserver"></a>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ IdentityServer

IdentityServer –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –≤ `ConfigureServices` –º–µ—Ç–æ–¥ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è `Startup` –∫–ª–∞—Å—Å–∞ –ø—É—Ç–µ–º –≤—ã–∑–æ–≤–∞ `services.AddIdentityServer` –º–µ—Ç–æ–¥–∞, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è eShopOnContainers —Å—Å—ã–ª–∫—É:

```csharp
public void ConfigureServices(IServiceCollection services)  
{  
    ...  
    services.AddIdentityServer(x => x.IssuerUri = "null")  
        .AddSigningCredential(Certificate.Get())                 
        .AddAspNetIdentity<ApplicationUser>()  
        .AddConfigurationStore(builder =>  
            builder.UseSqlServer(connectionString, options =>  
                options.MigrationsAssembly(migrationsAssembly)))  
        .AddOperationalStore(builder =>  
            builder.UseSqlServer(connectionString, options =>  
                options.MigrationsAssembly(migrationsAssembly)))  
        .Services.AddTransient<IProfileService, ProfileService>();  
}
```

–ü–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ –º–µ—Ç–æ–¥–∞ `services.AddIdentityServer` –º–µ—Ç–æ–¥, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ fluent API –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

-   –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–ª—è –ø–æ–¥–ø–∏—Å—ã–≤–∞–Ω–∏—è.
-   API –∏ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫.
-   –ö–ª–∏–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–º –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –º–∞—Ä–∫–µ—Ä–æ–≤.
-   –£–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ ASP.NET Core.

>üí° **–°–æ–≤–µ—Ç**: –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é IdentityServer 4. IdentityServer 4 API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å IdentityServer –∏–∑ —Å–ø–∏—Å–∫–∞ –≤ –ø–∞–º—è—Ç–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Å—Å—ã–ª–∫—É eShopOnContainers —ç—Ç–∏—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π –≤ –ø–∞–º—è—Ç–∏ –∂–µ—Å—Ç–∫–æ –∑–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω—ã –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –û–¥–Ω–∞–∫–æ –≤ —Ä–∞–±–æ—á–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –∏—Ö –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å –ø–æ–º–æ—â—å—é —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–ª–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

–°–≤–µ–¥–µ–Ω–∏—è –æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ IdentityServer –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ASP.NET Core Identity —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [—Å –ø–æ–º–æ—â—å—é ASP.NET Identity Core](https://identityserver4.readthedocs.io/en/release/quickstarts/6_aspnet_identity.html) –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ IdentityServer.

#### <a name="configuring-api-resources"></a>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ API

–ü—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Ä–µ—Å—É—Ä—Å–æ–≤ API `AddInMemoryApiResources` –º–µ—Ç–æ–¥ –æ–∂–∏–¥–∞–µ—Ç `IEnumerable<ApiResource>` –∫–æ–ª–ª–µ–∫—Ü–∏–∏. –í —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞ –ø–æ–∫–∞–∑–∞–Ω `GetApis` –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —ç—Ç—É –∫–æ–ª–ª–µ–∫—Ü–∏—é –Ω–∞ eShopOnContainers –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é:

```csharp
public static IEnumerable<ApiResource> GetApis()  
{  
    return new List<ApiResource>  
    {  
        new ApiResource("orders", "Orders Service"),  
        new ApiResource("basket", "Basket Service")  
    };  
}
```

–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ IdentityServer —Å–ª–µ–¥—É–µ—Ç –∑–∞—â–∏—Ç–∏—Ç—å –∑–∞–∫–∞–∑–æ–≤ –∏ –ö–æ—Ä–∑–∏–Ω–∞ API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, IdentityServer —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π –¥–æ—Å—Ç—É–ø –º–∞—Ä–∫–µ—Ä—ã –±—É–¥—É—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–ª—è –≤–Ω–µ—Å–µ–Ω–∏—è –≤—ã–∑–æ–≤—ã —ç—Ç–∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ API. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ `ApiResource` –≤–≤–µ–¥–∏—Ç–µ —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [—Ä–µ—Å—É—Ä—Å–æ–≤ API](https://identityserver4.readthedocs.io/en/release/reference/api_resource.html#refapiresource) –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ IdentityServer 4.

#### <a name="configuring-identity-resources"></a>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ —Ä–µ—Å—É—Ä—Å–æ–≤

–ü—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Ä–µ—Å—É—Ä—Å—ã identity `AddInMemoryIdentityResources` –º–µ—Ç–æ–¥ –æ–∂–∏–¥–∞–µ—Ç `IEnumerable<IdentityResource>` –∫–æ–ª–ª–µ–∫—Ü–∏–∏. –£–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å—ã ‚Äî —ç—Ç–æ –¥–∞–Ω–Ω—ã–µ, —Ç–∞–∫–∏–µ –∫–∞–∫ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏–º—è –∏–ª–∏ –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã. –ö–∞–∂–¥—ã–π —Ä–µ—Å—É—Ä—Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –º–æ–∂–Ω–æ –Ω–∞–∑–Ω–∞—á–∏—Ç—å —Ç–∏–ø—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤–∫–ª—é—á–µ–Ω—ã –≤ —Ç–æ–∫–µ–Ω –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –í —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞ –ø–æ–∫–∞–∑–∞–Ω `GetResources` –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —ç—Ç—É –∫–æ–ª–ª–µ–∫—Ü–∏—é –Ω–∞ eShopOnContainers –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é:

```csharp
public static IEnumerable<IdentityResource> GetResources()  
{  
    return new List<IdentityResource>  
    {  
        new IdentityResources.OpenId(),  
        new IdentityResources.Profile()  
    };  
}
```

–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è OpenID Connect –∑–∞–¥–∞–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ [—Ä–µ—Å—É—Ä—Å—ã standard identity](https://openid.net/specs/openid-connect-core-1_0.html#ScopeClaims). –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ–º —è–≤–ª—è–µ—Ç—Å—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –≠—Ç–æ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –ø—É—Ç–µ–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ `IdentityResources.OpenId` —Ä–µ—Å—É—Ä—Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤.

> [!NOTE]
> `IdentityResources` –ö–ª–∞—Å—Å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ—Ö –æ–±–ª–∞—Å—Ç–µ–π, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –≤ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ OpenID Connect (openid, —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã, –ø—Ä–æ—Ñ–∏–ª—å, —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ –∞–¥—Ä–µ—Å).

IdentityServer —Ç–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ](https://identityserver4.readthedocs.io/en/release/topics/resources.html#defining-custom-identity-resources) –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ IdentityServer. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ `IdentityResource` –≤–≤–µ–¥–∏—Ç–µ —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [—Ä–µ—Å—É—Ä—Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤](https://identityserver4.readthedocs.io/en/release/reference/identity_resource.html) –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ IdentityServer 4.

#### <a name="configuring-clients"></a>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤

–ö–ª–∏–µ–Ω—Ç—ã ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å IdentityServer –º–∞—Ä–∫–µ—Ä—ã. –ö–∞–∫ –ø—Ä–∞–≤–∏–ª–æ —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –∫–∞–∫ –º–∏–Ω–∏–º—É–º:

-   –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º.
-   –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å–æ —Å–ª—É–∂–±–æ–π –º–∞—Ä–∫–µ—Ä–æ–≤ (–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–∞–∫ —Ç–∏–ø –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è).
-   –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ, –≥–¥–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–∫–µ–Ω—ã –¥–æ—Å—Ç—É–ø–æ–º –∏ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏—è–º–∏ (–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–∞–∫ URI –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è).
-   –°–ø–∏—Å–æ–∫ —Ä–µ—Å—É—Ä—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ (–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–∞–∫ –æ–±–ª–∞—Å—Ç–∏).

–ü—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∫–ª–∏–µ–Ω—Ç–æ–≤, `AddInMemoryClients` –º–µ—Ç–æ–¥ –æ–∂–∏–¥–∞–µ—Ç `IEnumerable<Client>` –∫–æ–ª–ª–µ–∫—Ü–∏–∏. –í —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞ –ø–æ–∫–∞–∑–∞–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è eShopOnContainers –≤ `GetClients` –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —ç—Ç—É –∫–æ–ª–ª–µ–∫—Ü–∏—é –Ω–∞ eShopOnContainers –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é:

```csharp
public static IEnumerable<Client> GetClients(Dictionary<string,string> clientsUrl)
{
    return new List<Client>
    {
        ...
        new Client
        {
            ClientId = "xamarin",
            ClientName = "eShop Xamarin OpenId Client",
            AllowedGrantTypes = GrantTypes.Hybrid,
            ClientSecrets =
            {
                new Secret("secret".Sha256())
            },
            RedirectUris = { clientsUrl["Xamarin"] },
            RequireConsent = false,
            RequirePkce = true,
            PostLogoutRedirectUris = { $"{clientsUrl["Xamarin"]}/Account/Redirecting" },
            AllowedCorsOrigins = { "http://eshopxamarin" },
            AllowedScopes = new List<string>
            {
                IdentityServerConstants.StandardScopes.OpenId,
                IdentityServerConstants.StandardScopes.Profile,
                IdentityServerConstants.StandardScopes.OfflineAccess,
                "orders",
                "basket"
            },
            AllowOfflineAccess = true,
            AllowAccessTokensViaBrowser = true
        },
        ...
    };
}
```

–≠—Ç–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö —Å–≤–æ–π—Å—Ç–≤:

-   `ClientId`: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞.
-   `ClientName`: –ö–ª–∏–µ–Ω—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è, –∫–æ—Ç–æ—Ä–æ–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —ç–∫—Ä–∞–Ω–∞.
-   `AllowedGrantTypes`: –£–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç —Ö–æ—á–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å IdentityServer. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è —Å–º. [–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ç–æ–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏](#configuring_the_authentication_flow).
-   `ClientSecrets`: –£–∫–∞–∑—ã–≤–∞–µ—Ç —Å–µ–∫—Ä–µ—Ç–Ω—ã–π —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Ç–æ–∫–µ–Ω—ã –∏–∑ –∫–æ–Ω–µ—á–Ω–æ–π —Ç–æ—á–∫–∏ —Ç–æ–∫–µ–Ω–∞.
-   `RedirectUris`: –ó–∞–¥–∞–µ—Ç –¥–æ–ø—É—Å—Ç–∏–º—ã–π URL-–∞–¥—Ä–µ—Å–∞, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Ç–æ–∫–µ–Ω—ã –∏–ª–∏ –∫–æ–¥—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
-   `RequireConsent`: –£–∫–∞–∑—ã–≤–∞–µ—Ç, —Ç—Ä–µ–±—É–µ—Ç—Å—è –ª–∏ –Ω–∞ —ç–∫—Ä–∞–Ω —Å–æ–≥–ª–∞—Å–∏—è.
-   `RequirePkce`: –£–∫–∞–∑—ã–≤–∞–µ—Ç, –¥–æ–ª–∂–Ω—ã –ª–∏ –∫–ª–∏–µ–Ω—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–ª—é—á –ø—Ä–æ–≤–µ—Ä–∫–∏.
-   `PostLogoutRedirectUris`: –ó–∞–¥–∞–µ—Ç –¥–æ–ø—É—Å—Ç–∏–º—ã–π URL-–∞–¥—Ä–µ—Å–∞ –¥–ª—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞.
-   `AllowedCorsOrigins`: –£–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫ –∫–ª–∏–µ–Ω—Ç–∞, —á—Ç–æ–±—ã IdentityServer –º–æ–≥—É—Ç —Ä–∞–∑—Ä–µ—à–∏—Ç—å –≤—ã–∑–æ–≤—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –æ—Ç –Ω–∞—á–∞–ª–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç.
-   `AllowedScopes`: –£–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –∫–ª–∏–µ–Ω—Ç –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–ª–∏–µ–Ω—Ç –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ—Å—É—Ä—Å–∞–º.
-   `AllowOfflineAccess`: –£–∫–∞–∑—ã–≤–∞–µ—Ç, –º–æ–∂–µ—Ç –ª–∏ –∫–ª–∏–µ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

<a name="configuring_the_authentication_flow" />

#### <a name="configuring-the-authentication-flow"></a>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ç–æ–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏

–ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ IdentityServer –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å, —É–∫–∞–∑–∞–≤ —Ç–∏–ø –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –≤ `Client.AllowedGrantTypes` —Å–≤–æ–π—Å—Ç–≤–æ. –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ OpenID Connect –∏ OAuth 2.0 –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏, –≤–∫–ª—é—á–∞—è:

-   –ù–µ—è–≤–Ω—ã–µ. –≠—Ç–æ—Ç –ø–æ—Ç–æ–∫ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏–ª–∏ –∑–∞–ø—Ä–æ—Å—ã –º–∞—Ä–∫–µ—Ä–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏ –¥–æ—Å—Ç—É–ø–∞. –í—Å–µ –º–∞—Ä–∫–µ—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–æ—ç—Ç–æ–º—É –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–∞–∫ –º–∞—Ä–∫–µ—Ä—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã.
-   –ö–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –≠—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–≤–ª–µ–∫–∞—Ç—å —Ç–æ–∫–µ–Ω—ã –Ω–∞ –æ–±—Ä–∞—Ç–Ω—ã–π –∫–∞–Ω–∞–ª, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –ø–µ—Ä–µ–¥–Ω–µ–≥–æ –∫–∞–Ω–∞–ª–∞ –±—Ä–∞—É–∑–µ—Ä–∞ —Ç–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞.
-   –ì–∏–±—Ä–∏–¥–Ω—ã–π. –≠—Ç–æ—Ç –ø–æ—Ç–æ–∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å–æ—á–µ—Ç–∞–Ω–∏–µ –Ω–µ—è–≤–Ω—ã–π –∏ —Ç–∏–ø—ã —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –∫–æ–¥–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –¢–æ–∫–µ–Ω –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø–æ –∫–∞–Ω–∞–ª—É –±—Ä–∞—É–∑–µ—Ä–∞ –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—Ç–≤–µ—Ç –∑–Ω–∞–∫–æ–º –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –∏ –¥—Ä—É–≥–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã, —Ç–∞–∫–∏–µ –∫–∞–∫ –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–≤–µ—Ç–∞ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∏ —Ç–æ–∫–µ–Ω –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

> [!TIP]
> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–∏–±—Ä–∏–¥–Ω—ã–µ –ø–æ—Ç–æ–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏. –ü–æ—Ç–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ —Å–Ω–∏–∂–∞–µ—Ç —á–∏—Å–ª–æ –∞—Ç–∞–∫, –ø—Ä–∏–º–µ–Ω–∏–º—ã–µ –∫ –∫–∞–Ω–∞–ª—É –±—Ä–∞—É–∑–µ—Ä–∞ –∏ —è–≤–ª—è–µ—Ç—Å—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∏–∑–≤–ª–µ–∫–∞—Ç—å —Ç–æ–∫–µ–Ω—ã –¥–æ—Å—Ç—É–ø–∞ (–∏ –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è).

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ –ø–æ—Ç–æ–∫–∞—Ö –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [—Ç–∏–ø–æ–≤](https://identityserver4.readthedocs.io/en/release/topics/grant_types.html) –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ IdentityServer 4.

### <a name="performing-authentication"></a>–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏

–î–ª—è IdentityServer –¥–ª—è –≤—ã–¥–∞—á–∏ —Ç–æ–∫–µ–Ω–æ–≤ –æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –í–æ–π–¥–∏—Ç–µ –Ω–∞ IdentityServer. –û–¥–Ω–∞–∫–æ IdentityServer –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ eShopOnContainers —Å—Å—ã–ª–∫—É –¥–ª—è —ç—Ç–æ–π —Ü–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ASP.NET Core Identity.

EShopOnContainers –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —Å IdentityServer –≥–∏–±—Ä–∏–¥–Ω—ã—Ö –ø–æ—Ç–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –Ω–∞ —Ä–∏—Å—É–Ω–∫–µ 9-2.

![](authentication-and-authorization-images/sign-in.png "–í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –æ–±–∑–æ—Ä –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É")

**–†–∏—Å. 9-2:** –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –æ–±–∑–æ—Ä –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É

–ó–Ω–∞–∫ –≤ –∑–∞–ø—Ä–æ—Å–µ –∫ `<base endpoint>:5105/connect/authorize`. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ IdentityServer –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ —Ç–æ–∫–µ–Ω —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏—è. –ö–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏—Ö `<base endpoint>:5105/connect/token`, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç —Å –¥–æ—Å—Ç—É–ø–æ–º, —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–π –∏ —Ç–æ–∫–µ–Ω–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

EShopOnContainers –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–Ω–∞–∫–∏ –≤–Ω–µ—à–Ω–µ–π IdentityServer, –æ—Ç–ø—Ä–∞–≤–ª—è—è –∑–∞–ø—Ä–æ—Å –Ω–∞ `<base endpoint>:5105/connect/endsession`, —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤. –ü–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç IdentityServer –æ—Ç–≤–µ—á–∞–µ—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è—è URI –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã—Ö–æ–¥–∞ post –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –≠—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–∫–∞–∑–∞–Ω –Ω–∞ —Ä–∏—Å. 9-3.

![](authentication-and-authorization-images/sign-out.png "–í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –æ–±–∑–æ—Ä –ø—Ä–æ—Ü–µ—Å—Å –≤—ã—Ö–æ–¥–∞")

**–†–∏—Å. 9-3:** –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –æ–±–∑–æ—Ä –ø—Ä–æ—Ü–µ—Å—Å –≤—ã—Ö–æ–¥–∞

–í –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ eShopOnContainers –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å IdentityServer `IdentityService` –∫–ª–∞—Å—Å–∞, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–ª–∏–∑—É–µ—Ç `IIdentityService` –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —ç—Ç–æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –∫–ª–∞—Å—Å –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å `CreateAuthorizationRequest`, `CreateLogoutRequest`, –∏ `GetTokenAsync` –º–µ—Ç–æ–¥—ã.

#### <a name="signing-in"></a>–í–æ–π–¥–∏—Ç–µ –≤

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É **–≤—Ö–æ–¥–∞** –∫–Ω–æ–ø–∫—É `LoginView`, `SignInCommand` –≤ `LoginViewModel` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç `SignInAsync` –º–µ—Ç–æ–¥. –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –ø–æ–∫–∞–∑–∞–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞:

```csharp
private async Task SignInAsync()  
{  
    ...  
    LoginUrl = _identityService.CreateAuthorizationRequest();  
    IsLogin = true;  
    ...  
}
```

–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –≤—ã–∑—ã–≤–∞–µ—Ç `CreateAuthorizationRequest` –º–µ—Ç–æ–¥ `IdentityService` –∫–ª–∞—Å—Å–∞, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞:

```csharp
public string CreateAuthorizationRequest()
{
    // Create URI to authorization endpoint
    var authorizeRequest = new AuthorizeRequest(GlobalSetting.Instance.IdentityEndpoint);

    // Dictionary with values for the authorize request
    var dic = new Dictionary<string, string>();
    dic.Add("client_id", GlobalSetting.Instance.ClientId);
    dic.Add("client_secret", GlobalSetting.Instance.ClientSecret); 
    dic.Add("response_type", "code id_token");
    dic.Add("scope", "openid profile basket orders locations marketing offline_access");
    dic.Add("redirect_uri", GlobalSetting.Instance.IdentityCallback);
    dic.Add("nonce", Guid.NewGuid().ToString("N"));
    dic.Add("code_challenge", CreateCodeChallenge());
    dic.Add("code_challenge_method", "S256");

    // Add CSRF token to protect against cross-site request forgery attacks.
    var currentCSRFToken = Guid.NewGuid().ToString("N");
    dic.Add("state", currentCSRFToken);

    var authorizeUri = authorizeRequest.Create(dic); 
    return authorizeUri;
}

```

–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —Å–æ–∑–¥–∞–µ—Ç URI –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞ IdentityServer [–∫–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏](https://identityserver4.readthedocs.io/en/release/endpoints/authorize.html), —Å –Ω—É–∂–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏. –ö–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `/connect/authorize` —Å –ø–æ—Ä—Ç–∞ 5105 –±–∞–∑–æ–≤—ã–π –∫–æ–Ω–µ—á–Ω–æ–π —Ç–æ—á–∫–∏ –≤ –≤–∏–¥–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π](~/xamarin-forms/enterprise-application-patterns/configuration-management.md).

> [!NOTE]
> –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª—é—á –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∫–æ–¥–∞ Exchange (PKCE) –¥–ª—è OAuth —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è —É—è–∑–≤–∏–º–æ—Å—Ç—å eShopOnContainers –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ –æ–Ω–æ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ PKCE –∑–∞—â–∏—â–∞–µ—Ç –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –≠—Ç–æ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –ø—É—Ç–µ–º —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–Ω—ã–π verifier, —Ö—ç—à-–∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∑–∞–ø—Ä–æ—Å–µ –Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é, –∫–ª–∏–µ–Ω—Ç –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–µ –Ω–µ—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ PKCE —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–∫–ª—é—á –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–ª—è –æ–±–º–µ–Ω–∞ –∫–æ–¥–∞ –æ—Ç–∫—Ä—ã—Ç—ã–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏ OAuth](https://tools.ietf.org/html/rfc7636) –Ω–∞ –≤–µ–±-—Å–∞–π—Ç–µ Internet Engineering Task Force.

–ü–æ–ª—É—á–µ–Ω–Ω—ã–π URI —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `LoginUrl` —Å–≤–æ–π—Å—Ç–≤–æ `LoginViewModel` –∫–ª–∞—Å—Å–∞. –ö–æ–≥–¥–∞ `IsLogin` —Å–≤–æ–π—Å—Ç–≤–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `true`, [ `WebView` ](https://developer.xamarin.com/api/type/Xamarin.Forms.WebView/) –≤ `LoginView` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–∏–¥–∏–º—ã–º. `WebView` –ü—Ä–∏–≤—è–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –µ–≥–æ [ `Source` ](https://developer.xamarin.com/api/property/Xamarin.Forms.WebView.Source/) —Å–≤–æ–π—Å—Ç–≤–∞ `LoginUrl` —Å–≤–æ–π—Å—Ç–≤–æ `LoginViewModel` –∫–ª–∞—Å—Å–∞ –∏ –ø–æ—ç—Ç–æ–º—É IdentityServer –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤—Ö–æ–¥–∞ –ø—Ä–∏ `LoginUrl` —Å–≤–æ–π—Å—Ç–≤—É –ö–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ IdentityServer —ç–ª–µ–º–µ–Ω—Ç–∞. –ö–æ–≥–¥–∞ IdentityServer –ø–æ–ª—É—á–∞–µ—Ç —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å, –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–æ—à–µ–ª –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏, `WebView` –±—É–¥–µ—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –≤—Ö–æ–¥–∞, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –Ω–∞ —Ä–∏—Å—É–Ω–∫–µ 9-4.

![](authentication-and-authorization-images/login.png "–°—Ç—Ä–∞–Ω–∏—Ü—ã –≤—Ö–æ–¥–∞, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–æ–º WebView")

**–†–∏—Å. 9-4:** —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—Ö–æ–¥–∞, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–æ–º WebView

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Ö–æ–¥–∞ [ `WebView` ](https://developer.xamarin.com/api/type/Xamarin.Forms.WebView/) –±—É–¥—É—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π URI. –≠—Ç–æ `WebView` –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ `NavigateAsync` –º–µ—Ç–æ–¥ `LoginViewModel` –∫–ª–∞—Å—Å–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞:

```csharp
private async Task NavigateAsync(string url)  
{  
    ...  
    var authResponse = new AuthorizeResponse(url);  
    if (!string.IsNullOrWhiteSpace(authResponse.Code))  
    {  
        var userToken = await _identityService.GetTokenAsync(authResponse.Code);  
        string accessToken = userToken.AccessToken;  

        if (!string.IsNullOrWhiteSpace(accessToken))  
        {  
            Settings.AuthAccessToken = accessToken;  
            Settings.AuthIdToken = authResponse.IdentityToken;  

            await NavigationService.NavigateToAsync<MainViewModel>();  
            await NavigationService.RemoveLastFromBackStackAsync();  
        }  
    }  
    ...  
}
```

–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π—Å—è –≤ URI, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏, —á—Ç–æ –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –æ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å IdentityServer [–∫–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞ –º–∞—Ä–∫–µ—Ä–∞](https://identityserver4.readthedocs.io/en/release/endpoints/token.html), –ø–µ—Ä–µ–¥–∞–≤ –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ PKCE —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –¥—Ä—É–≥–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã. –ö–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞ –º–∞—Ä–∫–µ—Ä–∞ ‚Äî –≤ `/connect/token` —Å –ø–æ—Ä—Ç–∞ 5105 –±–∞–∑–æ–≤—ã–π –∫–æ–Ω–µ—á–Ω–æ–π —Ç–æ—á–∫–∏ –≤ –≤–∏–¥–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π](~/xamarin-forms/enterprise-application-patterns/configuration-management.md).

>üí° **–°–æ–≤–µ—Ç**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã URI. –ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ eShopOnContainers –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ URI, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π URI –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –≤ –∏–∑–≤–µ—Å—Ç–Ω–æ–º —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∞—Ç–∞–∫ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è open.

–ï—Å–ª–∏ –∫–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞ –º–∞—Ä–∫–µ—Ä–∞ –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π PKCE, —Ç–æ –≤ –æ—Ç–≤–µ—Ç –º–∞—Ä–∫–µ—Ä–∞ –¥–æ—Å—Ç—É–ø–∞, –º–∞—Ä–∫–µ—Ä –∏ –º–∞—Ä–∫–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è. –ú–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞ (–∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å–∞–º API) –∏ –º–∞—Ä–∫–µ—Ä –∑–∞—Ç–µ–º —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –≤–∏–¥–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –æ–±—â–∏–π —ç—Ñ—Ñ–µ–∫—Ç –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ eShopOnContainers —ç—Ç–æ: —É—Å–ª–æ–≤–∏–∏, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —Å IdentityServer, –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ `MainView` —Å—Ç—Ä–∞–Ω–∏—Ü–∞, –∫–æ—Ç–æ—Ä–∞—è —è–≤–ª—è–µ—Ç—Å—è [ `TabbedPage` ](https://developer.xamarin.com/api/type/Xamarin.Forms.TabbedPage/) –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç, `CatalogView` –∫–∞–∫ –µ–≥–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏.

–°–≤–µ–¥–µ–Ω–∏—è –æ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–Ω–∞–≤–∏–≥–∞—Ü–∏–∏](~/xamarin-forms/enterprise-application-patterns/navigation.md). –°–≤–µ–¥–µ–Ω–∏—è –æ —Ç–æ–º, –∫–∞–∫ [ `WebView` ](https://developer.xamarin.com/api/type/Xamarin.Forms.WebView/) –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥ –º–æ–¥–µ–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–≤—ã–∑–æ–≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é –ø–æ–≤–µ–¥–µ–Ω–∏–π](~/xamarin-forms/enterprise-application-patterns/navigation.md#invoking_navigation_using_behaviors). –°–≤–µ–¥–µ–Ω–∏—è –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π](~/xamarin-forms/enterprise-application-patterns/configuration-management.md).

> [!NOTE]
> EShopOnContainers —Ç–∞–∫–∂–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–∞–∫–µ—Ç–æ–≤ –≤—Ö–æ–¥ –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–ª—É–∂–± –º–∞–∫–µ—Ç–æ–≤ –≤ `SettingsView`. –í —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —Å IdentityServer, –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–æ–π—Ç–∏, –∏—Å–ø–æ–ª—å–∑—É—è —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

#### <a name="signing-out"></a>–ü–æ–¥–ø–∏—Å–∏ out

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É **–í—ã—Ö–æ–¥** –∫–Ω–æ–ø–∫—É –≤ `ProfileView`, `LogoutCommand` –≤ `ProfileViewModel` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç `LogoutAsync` –º–µ—Ç–æ–¥. –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º –¥–ª—è `LoginView` —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –ø–µ—Ä–µ–¥–∞–≤ `LogoutParameter` —ç–∫–∑–µ–º–ø–ª—è—Ä –∑–Ω–∞—á–µ–Ω–∏–µ `true` –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ –ø–µ—Ä–µ–¥–∞—á–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–ø–µ—Ä–µ–¥–∞—á–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤–æ –≤—Ä–µ–º—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏](~/xamarin-forms/enterprise-application-patterns/navigation.md#passing_parameters_during_navigation).

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏ –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω –ø–µ—Ä–µ—Ö–æ–¥, `InitializeAsync` –º–æ–¥–µ–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –º–µ—Ç–æ–¥–∞, –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç `Logout` –º–µ—Ç–æ–¥ `LoginViewModel` –∫–ª–∞—Å—Å–∞, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞:

```csharp
private void Logout()  
{  
    var authIdToken = Settings.AuthIdToken;  
    var logoutRequest = _identityService.CreateLogoutRequest(authIdToken);  

    if (!string.IsNullOrEmpty(logoutRequest))  
    {  
        // Logout  
        LoginUrl = logoutRequest;  
    }  
    ...  
}
```

–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –≤—ã–∑—ã–≤–∞–µ—Ç `CreateLogoutRequest` –º–µ—Ç–æ–¥ `IdentityService` –∫–ª–∞—Å—Å–∞, –ø–µ—Ä–µ–¥–∞–≤ —Ç–æ–∫–µ–Ω –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π](~/xamarin-forms/enterprise-application-patterns/configuration-management.md). –í —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞ –ø–æ–∫–∞–∑–∞–Ω `CreateLogoutRequest` –º–µ—Ç–æ–¥:

```csharp
public string CreateLogoutRequest(string token)  
{  
    ...  
    return string.Format("{0}?id_token_hint={1}&post_logout_redirect_uri={2}",   
        GlobalSetting.Instance.LogoutEndpoint,  
        token,  
        GlobalSetting.Instance.LogoutCallback);  
}
```

–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —Å–æ–∑–¥–∞–µ—Ç URI –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞ IdentityServer [–æ–∫–æ–Ω—á–∞–Ω–∏—è —Å–µ–∞–Ω—Å–∞ –∫–æ–Ω–µ—á–Ω–æ–π —Ç–æ—á–∫–∏](https://identityserver4.readthedocs.io/en/release/endpoints/endsession.html#refendsession), —Å –Ω—É–∂–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏. –ö–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å–µ–∞–Ω—Å–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `/connect/endsession` —Å –ø–æ—Ä—Ç–∞ 5105 –±–∞–∑–æ–≤—ã–π –∫–æ–Ω–µ—á–Ω–æ–π —Ç–æ—á–∫–∏ –≤ –≤–∏–¥–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π](~/xamarin-forms/enterprise-application-patterns/configuration-management.md).

–ü–æ–ª—É—á–µ–Ω–Ω—ã–π URI —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `LoginUrl` —Å–≤–æ–π—Å—Ç–≤–æ `LoginViewModel` –∫–ª–∞—Å—Å–∞. –•–æ—Ç—è `IsLogin` —Å–≤–æ–π—Å—Ç–≤–æ `true`, [ `WebView` ](https://developer.xamarin.com/api/type/Xamarin.Forms.WebView/) –≤ `LoginView` —è–≤–ª—è–µ—Ç—Å—è –≤–∏–¥–∏–º—ã–º. `WebView` –ü—Ä–∏–≤—è–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –µ–≥–æ [ `Source` ](https://developer.xamarin.com/api/property/Xamarin.Forms.WebView.Source/) —Å–≤–æ–π—Å—Ç–≤–∞ `LoginUrl` —Å–≤–æ–π—Å—Ç–≤–æ `LoginViewModel` –∫–ª–∞—Å—Å–∞ –∏ –ø–æ—ç—Ç–æ–º—É –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≤—ã—Ö–æ–¥–∞ IdentityServer –ø—Ä–∏ `LoginUrl` —Å–≤–æ–π—Å—Ç–≤—É –ö–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞ IdentityServer —ç–ª–µ–º–µ–Ω—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å–µ–∞–Ω—Å–∞. –ö–æ–≥–¥–∞ IdentityServer –ø–æ–ª—É—á–∞–µ—Ç —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å, –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –≤—ã–ø–æ–ª–Ω–∏–≤—à–∏–π –≤—Ö–æ–¥, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—ã—Ö–æ–¥. –û–±—ä–µ–∫—Ç cookie, —É–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö –ø–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Å–ª–æ—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–∞ cookie –∏–∑ ASP.NET Core –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –≤—ã—Ö–æ–¥–µ –∏–∑ IdentityServer —É–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª cookie –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å–∏—Å—Ç–µ–º—ã, URI –æ–±—Ä–∞—Ç–Ω–æ –∫–ª–∏–µ–Ω—Ç—É.

–í –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ [ `WebView` ](https://developer.xamarin.com/api/type/Xamarin.Forms.WebView/) –±—É–¥–µ—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ URI –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã—Ö–æ–¥–∞ post. –≠—Ç–æ `WebView` –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ `NavigateAsync` –º–µ—Ç–æ–¥ `LoginViewModel` –∫–ª–∞—Å—Å–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞:

```csharp
private async Task NavigateAsync(string url)  
{  
    ...  
    Settings.AuthAccessToken = string.Empty;  
    Settings.AuthIdToken = string.Empty;  
    IsLogin = false;  
    LoginUrl = _identityService.CreateAuthorizationRequest();  
    ...  
}
```

–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —É–¥–∞–ª—è–µ—Ç –º–∞—Ä–∫–µ—Ä –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –∏ —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –∑–∞–¥–∞–µ—Ç `IsLogin` —Å–≤–æ–π—Å—Ç–≤–∞ `false`, —á–µ–≥–æ [ `WebView` ](https://developer.xamarin.com/api/type/Xamarin.Forms.WebView/) –Ω–∞ `LoginView` —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á—Ç–æ–±—ã —Å—Ç–∞—Ç—å –Ω–µ–≤–∏–¥–∏–º—ã–º . –ù–∞–∫–æ–Ω–µ—Ü `LoginUrl` —Å–≤–æ–π—Å—Ç–≤—É IdentityServer URI –∏–∑ [–∫–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏](https://identityserver4.readthedocs.io/en/release/endpoints/authorize.html), —Å –Ω—É–∂–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –≤—Ö–æ–¥ –≤.

–°–≤–µ–¥–µ–Ω–∏—è –æ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–Ω–∞–≤–∏–≥–∞—Ü–∏–∏](~/xamarin-forms/enterprise-application-patterns/navigation.md). –°–≤–µ–¥–µ–Ω–∏—è –æ —Ç–æ–º, –∫–∞–∫ [ `WebView` ](https://developer.xamarin.com/api/type/Xamarin.Forms.WebView/) –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥ –º–æ–¥–µ–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–≤—ã–∑–æ–≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é –ø–æ–≤–µ–¥–µ–Ω–∏–π](~/xamarin-forms/enterprise-application-patterns/navigation.md#invoking_navigation_using_behaviors). –°–≤–µ–¥–µ–Ω–∏—è –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π](~/xamarin-forms/enterprise-application-patterns/configuration-management.md).

> [!NOTE]
> EShopOnContainers —Ç–∞–∫–∂–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–∞–∫–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã—Ö–æ–¥–∞, –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–ª—É–∂–± –º–∞–∫–µ—Ç–æ–≤ –≤ SettingsView. –í —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å IdentityServer –∏ –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –æ—á–∏—â–∞–µ—Ç –≤—Å–µ —Ö—Ä–∞–Ω–∏–º—ã–µ —Ç–æ–∫–µ–Ω—ã –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

<a name="authorization" />

## <a name="authorization"></a>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ ASP.NET Core web API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —á–∞—Å—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–ª—É–∂–±–µ —Å API –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø—Ä–æ—à–µ–¥—à–∏—Ö –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏, –Ω–æ –Ω–µ –¥–ª—è –≤—Å–µ—Ö.

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∞—Ä—à—Ä—É—Ç ASP.NET MVC –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –º–æ–∂–µ—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å—Å—è –ø—É—Ç–µ–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–∞ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É –∏–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ, –ø—Ä–æ—à–µ–¥—à–∏–º –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞:

```csharp
[Authorize]  
public class BasketController : Controller  
{  
    ...  
}
```

–ï—Å–ª–∏ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É –∏–ª–∏ –¥–µ–π—Å—Ç–≤–∏—é, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–º–µ—á–µ–Ω –∞—Ç—Ä–∏–±—É—Ç–æ–º `Authorize` –∞—Ç—Ä–∏–±—É—Ç, –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ MVC –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–¥ —Å–æ—Å—Ç–æ—è–Ω–∏—è 401 (–Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π) HTTP.

> [!NOTE]
> –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–≥—É—Ç –∑–∞–¥–∞–≤–∞—Ç—å—Å—è –Ω–∞ `Authorize` –∞—Ç—Ä–∏–±—É—Ç–∞ –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è API –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏](/aspnet/core/security/authorization/introduction/).

IdentityServer –º–æ–∂–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, —á—Ç–æ–±—ã —Ç–æ–∫–µ–Ω—ã –¥–æ—Å—Ç—É–ø–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –ø–æ–∫–∞–∑–∞–Ω –Ω–∞ —Ä–∏—Å—É–Ω–∫–µ 9-5.

![](authentication-and-authorization-images/authorization.png "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –º–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞")

**–†–∏—Å. 9-5:** –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –º–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞

–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ eShopOnContainers –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –º–∏–∫—Ä–æ—Å–ª—É–∂–±—É —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–π –∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –º–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞ –≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏. API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–µ –º–∏–∫—Ä–æ—Å–ª—É–∂–±–∞–º–∏ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–∏–µ –∏ –ö–æ—Ä–∑–∏–Ω–∞ –∫–∞–∫ —á–∞—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–æ—Å—Ç—É–ø–∞ –∑–∞—Ç–µ–º –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –º–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞. –ú–∞—Ä–∫–µ—Ä—ã –¥–æ—Å—Ç—É–ø–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç —Å–≤–µ–¥–µ–Ω–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å. API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –∑–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –∏—Ö –¥–∞–Ω–Ω—ã–º. –°–≤–µ–¥–µ–Ω–∏—è –æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ IdentityServer –¥–ª—è –∑–∞—â–∏—Ç—ã API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ API](#configuring-api-resources).

### <a name="configuring-identityserver-to-perform-authorization"></a>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ IdentityServer –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

–î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é IdentityServer, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –µ–≥–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Å–ª–æ—è –≤ –∫–æ–Ω–≤–µ–π–µ—Ä–µ HTTP –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Å–ª–æ—è –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ `ConfigureAuth` –º–µ—Ç–æ–¥ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è `Startup` –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏–∑ `Configure` –º–µ—Ç–æ–¥–∞ –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è eShopOnContainers —Å—Å—ã–ª–∫—É:

```csharp
protected virtual void ConfigureAuth(IApplicationBuilder app)  
{  
    var identityUrl = Configuration.GetValue<string>("IdentityUrl");  
    app.UseIdentityServerAuthentication(new IdentityServerAuthenticationOptions  
    {  
        Authority = identityUrl.ToString(),  
        ScopeName = "basket",  
        RequireHttpsMetadata = false  
    });  
} 
```

–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ API –º–æ–∂–µ—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ —Å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π –º–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞. –ü–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Å–ª–æ—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Ö–æ–¥—è—â–∏–π —Ç–æ–∫–µ–Ω, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å –Ω–∞–¥–µ–∂–Ω—ã–º –∏–∑–¥–∞—Ç–µ–ª–µ–º –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –º–∞—Ä–∫–µ—Ä —è–≤–ª—è–µ—Ç—Å—è –¥–æ–ø—É—Å—Ç–∏–º—ã–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å API, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∏—Ç –µ–≥–æ. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –ø–µ—Ä–µ–π–¥—è –∫ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏–ª–∏ –∫–æ—Ä–∑–∏–Ω—ã –≤–µ—Ä–Ω–µ—Ç 401 (–Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π) –∫–æ–¥ —Å–æ—Å—Ç–æ—è–Ω–∏—è HTTP, —É–∫–∞–∑—ã–≤–∞—é—â–µ–µ, —á—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –º–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞.

> [!NOTE]
> –ü–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Å–ª–æ—è IdentityServer –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω–≤–µ–π–µ—Ä –∑–∞–ø—Ä–æ—Å–æ–≤ HTTP –¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º MVC —Å `app.UseMvc()` –∏–ª–∏ `app.UseMvcWithDefaultRoute()`.

### <a name="making-access-requests-to-apis"></a>–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

–ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –º–∏–∫—Ä–æ—Å–ª—É–∂–±–∞–º–∏ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–∏–µ –∏ –ö–æ—Ä–∑–∏–Ω–∞, –¥–æ—Å—Ç—É–ø –º–∞—Ä–∫–µ—Ä–∞, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –∏–∑ IdentityServer –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏, –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω –≤ –∑–∞–ø—Ä–æ—Å, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞:

```csharp
var authToken = Settings.AuthAccessToken;  
Order = await _ordersService.GetOrderAsync(Convert.ToInt32(order.OrderNumber), authToken);
```

–¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –ø–æ–ª—É—á–∏—Ç—å –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π –∏ –≤–∫–ª—é—á–µ–Ω—ã –≤ –≤—ã–∑–æ–≤–µ `GetOrderAsync` –º–µ—Ç–æ–¥ `OrderService` –∫–ª–∞—Å—Å–∞.

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –º–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö IdentityServer –∑–∞—â–∏—â–µ–Ω–Ω—ã–º API, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞:

```csharp
var authToken = Settings.AuthAccessToken;  
await _basketService.UpdateBasketAsync(new CustomerBasket  
{  
    BuyerId = userInfo.UserId,   
    Items = BasketItems.ToList()  
}, authToken);
```

–ú–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –∏ –≤–∫–ª—é—á–µ–Ω—ã –≤ –≤—ã–∑–æ–≤–µ `UpdateBasketAsync` –º–µ—Ç–æ–¥ `BasketService` –∫–ª–∞—Å—Å–∞.

`RequestProvider` –ö–ª–∞—Å—Å, –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ eShopOnContainers –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `HttpClient` –∫–ª–∞—Å—Å –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ RESTful API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º eShopOnContainers —Å—Å—ã–ª–∫–∏. –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –≤–Ω–µ—Å–µ–Ω–∏—è –¥–ª—è —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–∏—è –∏ –ö–æ—Ä–∑–∏–Ω–∞ API, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±—É—é—Ç –Ω–∞–ª–∏—á–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π –º–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω –≤ –∑–∞–ø—Ä–æ—Å. –≠—Ç–æ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –ø—É—Ç–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º `HttpClient` —ç–∫–∑–µ–º–ø–ª—è—Ä–∞, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞:

```csharp
httpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token);
```

`DefaultRequestHeaders` –°–≤–æ–π—Å—Ç–≤–æ `HttpClient` –∫–ª–∞—Å—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ `Authorization` –ø—Ä–µ—Ñ–∏–∫—Å–æ–º —Å–æ —Å—Ç—Ä–æ–∫–æ–π –∑–∞–≥–æ–ª–æ–≤–∫–∞ `Bearer`. –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω API RESTful, –∑–Ω–∞—á–µ–Ω–∏–µ `Authorization` –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –æ—Ç –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ –∏–∑–¥–∞—Ç–µ–ª—è –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, –∏–º–µ–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –≤—ã–∑–æ–≤ API-–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –ø–æ–ª—É—á–∞–µ—Ç –µ–≥–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫.

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ –∫–∞–∫ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ eShopOnContainers –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–µ–±-–∑–∞–ø—Ä–æ—Å–æ–≤ —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–¥–æ—Å—Ç—É–ø –∫ —É–¥–∞–ª–µ–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º](~/xamarin-forms/enterprise-application-patterns/accessing-remote-data.md).

## <a name="summary"></a>–°–≤–æ–¥–∫–∞

–°—É—â–µ—Å—Ç–≤—É–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Xamarin.Forms, –∫–æ—Ç–æ—Ä—ã–π –æ–±–º–µ–Ω–∏–≤–∞–µ—Ç—Å—è –¥–∞–Ω–Ω—ã–º–∏ —Å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ASP.NET MVC. –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ eShopOnContainers –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é –º–∏–∫—Ä–æ—Å–ª—É–∂–±—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–æ–≥–æ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–π, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π IdentityServer 4. IdentityServer —è–≤–ª—è–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç–æ–π OpenID Connect –∏ OAuth 2.0 –ø–ª–∞—Ç—Ñ–æ—Ä–º—É ASP.NET Core, –∫–æ—Ç–æ—Ä–æ–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å ASP.NET Identity Core –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –º–∞—Ä–∫–µ—Ä–∞ –Ω–æ—Å–∏—Ç–µ–ª—è.

–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç IdentityServer, –º–∞—Ä–∫–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ—Å—É—Ä—Å—É. –ü—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ —Ä–µ—Å—É—Ä—Å—É, –º–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞ –¥–æ–ª–∂–Ω—ã –≤–∫–ª—é—á–∞—Ç—å—Å—è –≤ –∑–∞–ø—Ä–æ—Å API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, —Ç—Ä–µ–±—É—é—â–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ü–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Å–ª–æ—è IdentityServer –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ —Ç–æ–∫–µ–Ω—ã –¥–æ—Å—Ç—É–ø–∞, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –æ—Ç –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ –∏–∑–¥–∞—Ç–µ–ª—è –∏ —á—Ç–æ –æ–Ω–∏ —è–≤–ª—è—é—Ç—Å—è –¥–æ–ø—É—Å—Ç–∏–º—ã–º–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –ø–æ–º–æ—â—å—é API, –∫–æ—Ç–æ—Ä—ã–π –∏—Ö –ø–æ–ª—É—á–∞–µ—Ç.


## <a name="related-links"></a>–°–≤—è–∑–∞–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [–ó–∞–≥—Ä—É–∑–∏—Ç—å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –∫–Ω–∏–≥—É (2 –ú–ë –≤ —Ñ–æ—Ä–º–∞—Ç–µ PDF)](https://aka.ms/xamarinpatternsebook)
- [eShopOnContainers (GitHub) (–ø—Ä–∏–º–µ—Ä)](https://github.com/dotnet-architecture/eShopOnContainers)
